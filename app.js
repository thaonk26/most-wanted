var dataObject = {
    "272822514": {
        "firstName": "Billy",
        "lastName": "Bob",
        "gender": "male",
        "dob": "1/18/1949",
        "height": 71,
        "weight": 175,
        "eyeColor": "brown",
        "occupation": "programmer",
        "parents": [],
        "currentSpouse": 401222887
    },
    "401222887": {
        "firstName": "Uma",
        "lastName": "Bob",
        "gender": "female",
        "dob": "4/1/1947",
        "height": 65,
        "weight": 162,
        "eyeColor": "brown",
        "occupation": "assistant",
        "parents": [],
        "currentSpouse": 272822514
    },
    "409574486": {
        "firstName": "Michael",
        "lastName": "Walkens",
        "gender": "male",
        "dob": "5/9/1951",
        "height": 76,
        "weight": 250,
        "eyeColor": "brown",
        "occupation": "landscaper",
        "parents": [],
        "currentSpouse": 260451248
    },
    "260451248": {
        "firstName": "Jon",
        "lastName": "Walkens",
        "gender": "male",
        "dob": "9/6/1945",
        "height": 62,
        "weight": 115,
        "eyeColor": "brown",
        "occupation": "assistant",
        "parents": [],
        "currentSpouse": 409574486
    },
    "629807187": {
        "firstName": "Jack",
        "lastName": "Pafoy",
        "gender": "male",
        "dob": "3/16/1938",
        "height": 70,
        "weight": 207,
        "eyeColor": "black",
        "occupation": "nurse",
        "parents": [],
        "currentSpouse": 464142841
    },
    "464142841": {
        "firstName": "Jen",
        "lastName": "Pafoy",
        "gender": "female",
        "dob": "4/10/1940",
        "height": 72,
        "weight": 256,
        "eyeColor": "black",
        "occupation": "student",
        "parents": [],
        "currentSpouse": 629807187
    },
    "982411429": {
        "firstName": "Mister",
        "lastName": "Potatoo",
        "gender": "male",
        "dob": "12/18/1952",
        "height": 66,
        "weight": 170,
        "eyeColor": "hazel",
        "occupation": "architect",
        "parents": [],
        "currentSpouse": 595767575
    },
    "595767575": {
        "firstName": "Missuz",
        "lastName": "Potatoo",
        "gender": "female",
        "dob": "10/28/1948",
        "height": 59,
        "weight": 137,
        "eyeColor": "blue",
        "occupation": "architect",
        "parents": [],
        "currentSpouse": 982411429
    },
    "693243224": {
        "firstName": "Joy",
        "lastName": "Madden",
        "gender": "female",
        "dob": "4/20/1939",
        "height": 69,
        "weight": 199,
        "eyeColor": "hazel",
        "occupation": "doctor",
        "parents": [],
        "currentSpouse": 693243224
    },
    "888201200": {
        "firstName": "Mader",
        "lastName": "Madden",
        "gender": "male",
        "dob": "5/6/1937",
        "height": 76,
        "weight": 205,
        "eyeColor": "black",
        "occupation": "landscaper",
        "parents": [],
        "currentSpouse": 888201200
    },
    "878013758": {
        "firstName": "Jill",
        "lastName": "Pafoy",
        "gender": "Bob",
        "dob": "2/8/1972",
        "height": 74,
        "weight": 118,
        "eyeColor": "brown",
        "occupation": "programmer",
        "parents": [401222887, 401222887],
        "currentSpouse": 294874671
    },
    "951747547": {
        "firstName": "Ralph",
        "lastName": "Bob",
        "gender": "male",
        "dob": "12/23/1969",
        "height": 66,
        "weight": 179,
        "eyeColor": "blue",
        "occupation": "nurse",
        "parents": [401222887, 401222887],
        "currentSpouse": 159819275
    },
    "159819275": {
        "firstName": "Jasmine",
        "lastName": "Bob",
        "gender": "female",
        "dob": "12/18/1969",
        "height": 58,
        "weight": 156,
        "eyeColor": "blue",
        "occupation": "assistant",
        "parents": [409574486, 260451248],
        "currentSpouse": 951747547
    },
    "348457184": {
        "firstName": "Annie",
        "lastName": "Pafoy",
        "gender": "female",
        "dob": "11/4/1970",
        "height": 62,
        "weight": 235,
        "eyeColor": "hazel",
        "occupation": "landscaper",
        "parents": [629807187, 464142841],
        "currentSpouse": null
    },
    "294874671": {
        "firstName": "Dave",
        "lastName": "Pafoy",
        "gender": "male",
        "dob": "8/5/1967",
        "height": 61,
        "weight": 112,
        "eyeColor": "green",
        "occupation": "doctor",
        "parents": [629807187, 464142841],
        "currentSpouse": 878013758
    },
    "931247228": {
        "firstName": "Amii",
        "lastName": "Pafoy",
        "gender": "female",
        "dob": "3/13/1963",
        "height": 74,
        "weight": 184,
        "eyeColor": "brown",
        "occupation": "landscaper",
        "parents": [629807187, 464142841],
        "currentSpouse": null
    },
    "822843554": {
        "firstName": "Regina",
        "lastName": "Madden",
        "gender": "female",
        "dob": "7/26/1959",
        "height": 71,
        "weight": 249,
        "eyeColor": "brown",
        "occupation": "nurse",
        "parents": [693243224, 888201200],
        "currentSpouse": null
    },
    "819168108": {
        "firstName": "Hana",
        "lastName": "Madden",
        "gender": "female",
        "dob": "10/7/1953",
        "height": 70,
        "weight": 187,
        "eyeColor": "brown",
        "occupation": "politician",
        "parents": [693243224, 888201200],
        "currentSpouse": null
    },
    "969837479": {
        "firstName": "Eloise",
        "lastName": "Madden",
        "gender": "female",
        "dob": "12/11/1961",
        "height": 63,
        "weight": 241,
        "eyeColor": "brown",
        "occupation": "assistant",
        "parents": [693243224, 888201200],
        "currentSpouse": null
    },
    "313207561": {
        "firstName": "Mattias",
        "lastName": "Madden",
        "gender": "male",
        "dob": "2/19/1966",
        "height": 70,
        "weight": 110,
        "eyeColor": "blue",
        "occupation": "assistant",
        "parents": [693243224, 888201200],
        "currentSpouse": 313997561
    },
    "313997561": {
        "firstName": "Ellen",
        "lastName": "Madden",
        "gender": "female",
        "dob": "2/19/1970",
        "height": 67,
        "weight": 100,
        "eyeColor": "blue",
        "occupation": "doctor",
        "parents": [],
        "currentSpouse": 313207561
    },
    "313998000": {
        "firstName": "Joey",
        "lastName": "Madden",
        "gender": "female",
        "dob": "2/02/1987",
        "height": 67,
        "weight": 100,
        "eyeColor": "blue",
        "occupation": "doctor",
        "parents": [313207561, 313997561],
        "currentSpouse": null
    }
};


/*function printAllToConsole(dataObj){
    for (var key in dataObj) {
        if (dataObj.hasOwnProperty(key)) {
            console.log(key + " -> " + JSON.stringify(dataObj[key]);
        }
    }
}
printAllToConsole(dataObject);*/
/*var person = {
    'person': [],
    'heights': [],
    'weights': [],
    'gender': [],
    'eyecolor': [],
    'occupation': [],
    'parents': [],
    'currentSpouse': []
};*/
findPersonInfo();

function findPersonInfo() {
    var answer = prompt(
        "Type 1 if you want to search by first AND last name.\r\n" +
        " Type 2 if you want to search for a person's descendant(s). \n** First and last name required **\r\n" +
        " Type 3 if you want to search by physical traits (up to 5 traits).\r\n" +
        " Type 4 if you want to search by age.\r\n" +
        " Type 5 if you want to search by age range.\r\n" +
        " Type 6 if you want to search by immediate family.\r\n" +
        " Type 7 if you want to search by next of kin.\r\n" +
        " Type \"exit\" if you want to end the program."
    );
	var personToList = [];
    switch (answer) {

        case "1":
            personToList = [];
            var foundPerson = searchPrompt();
            if (foundPerson != 0 && foundPerson != undefined) {
                displayPerson(dataObject[foundPerson], "Person Requested:\r\n");
                break;
            }
            alert("No data found.")
            break;
        case "2":
            personToList = [];
            var foundPerson = searchPrompt();
            getGrandKids(getDescendant(foundPerson, personToList), personToList);
            if (personToList == 0) {error(undefined);}
            displayListOfPeople(personToList, "Descendant(s): \r\n");
            break;
        case "3":
            personToList = [];
            var result = prompt("Pick up to five traits to search. (gender, height, weight, eye color or occupation)");
            separateTraits(result, personToList);
            //getTrait(result, getPersonTrait(result), personToList);
            displayListOfPeople(personToList, "Traits: \r\n");
            break;
        case "4":
            personToList = [];
            searchAge(prompt("How old are they?"), personToList);
            //ageRangeSearch(prompt("What is the youngest age you think they are?"),prompt("What is the oldest age you think they are?"), personToList);
            if(personToList != 0){
            displayListOfPeople(personToList, "Age: \r\n");
            break;
            }
            error(undefined);
            break;
        case "5":
        	personToList = [];
            ageRangeSearch(prompt("What is the youngest age you think they are?"),prompt("What is the oldest age you think they are?"), personToList);
            if(personToList != 0){
            displayListOfPeople(personToList, "Age: \r\n");
            break;
            }
            error(undefined);
            
            break;
        case "6":
            personToList = [];
            immediateFamily(searchPrompt(), personToList)
            displayListOfPeople(personToList, "Immediate Family: \r\n");
            //window.close();
            //endProgram();
            break;
        case "7":
            personToList = [];
            getNextOfKin(searchPrompt(), personToList);
            if (personToList != 0) {
                displayPerson(dataObject[getOldest(personToList)], "Next of Kin: \r\n");
                break;
            }
            alert("This person has no Next of Kin.")
            break;
        default:
            alert("I'm sorry, but that's not an option. Please try again")
            break;
    }
    //findPersonInfo();
}

function endProgram() {
    window.close();
}

function searchPrompt() {
    return getPersonInfo(prompt("What is the person's first name?"), prompt("What is their last name?"));
}

function getPersonInfo(firstname, lastname) {

    for (var key in dataObject) {
        if (dataObject.hasOwnProperty(key)) {
            //console.log(obj.firstName, obj.lastName);
            if (firstname.toLowerCase() === dataObject[key].firstName.toLowerCase() && lastname.toLowerCase() === dataObject[key].lastName.toLowerCase()) {
                //console.log(dataObject[key]);
                return key;
            }
        }
    }
}

function searchAge(age, list) {
    for (var a in dataObject) {
        if (getAge(dataObject[a].dob) == parseInt(age))
            list.push(a);
    }
}
function ageRangeSearch(start, end, list){
	for(var key in dataObject){
		if(getAge(dataObject[key].dob) >= start && getAge(dataObject[key].dob) <= end)
		 {list.push(key);}
	}
}
function getAge(age) {
    var today = new Date();
    var currentDOB = age.split("/");
    var ageYear = (today.getFullYear() - currentDOB[2]);
    var ageMonth = (today.getMonth() - currentDOB[0]);
    var ageDay = (today.getDate() - currentDOB[1]);

    if (ageMonth < 0 || (ageMonth == 0 && ageDay < 0)) {
        ageYear = ageYear - 1;
    }
    ageYear = parseInt(ageYear);
    return ageYear;
}

function getOldest(listOfPeople) {
    var OldestPerson = undefined;
    for (var i = 0; i < listOfPeople.length; i++) {
        var currentDOB = dataObject[listOfPeople[i]].dob.split("/");
        if (OldestPerson != undefined) {
            var lastDOB = dataObject[OldestPerson].dob.split("/");
        }
        if (OldestPerson == undefined) {
            OldestPerson = listOfPeople[i];
        } else if (currentDOB[2] < lastDOB[2]) {
            OldestPerson = listOfPeople[i];
        }
    }
    return OldestPerson;
}

function sortByOldest(list) {
    var tmp = [];
    for (var i = 0; i < list.length; i++) {
        for (var j = 0; j < list.length; j++) {

            if (list[j] > list[j + 1]) {
                tmp = list[j];
                list[j] = list[j + 1];
                list[j + 1] = tmp;
            }
        }
    }
}

function getNextOfKin(person, list) {
    getSpouse(person, list);
    var kin = [];
    var siblingKin = [];
    if (list.length == 0) {
        kin = getDescendant(person, list);
    }
    if (list.length == 0) {
        getParents(dataObject[person].parents, list);
    }
    if (list.length == 0) {
        siblingKin = getSiblings(dataObject[person].parents, list);
    }
    if (list.length == 0) {
        getGrandKids(kin, list);
        getGrandKids(siblingKin, list);
    }
}

function getSpouse(person, list) {
    getTrait("currentSpouse", person, list);
}

function getTrait(traitType, userInput, list) {
    for (var key in dataObject) {
        if (userInput == dataObject[key][traitType]) {
            if (dataObject[key][traitType] != key) {
                list.push(key);
            }
        }
    }
}

function getPersonTrait(trait) {
    var trait = prompt("");
    switch (trait) {
        case "gender":
            var gender = prompt("Male or Female?");
            return gender;
        case "height":
            var height = prompt("What is their aproximate height?")
            return height;
        case "weight":
            var weight = prompt("What is their aproximate weight?")
            return weight;
        case "eye color":
            var eyeColor = prompt("What is their eye color?");
            return eyeColor;
        case "occupation":

            return occupation;
        default:
            alert("Not a valid entry, please try again.")
            break;
    }
    findPersonInfo();
}
function separateTraits(listOfTraits, listOfPeople){
	var trait = undefined;
	if(listOfTraits.length > 1){
		for(var key in dataObject){
			for(var i = 0; i < listOfTraits; i++){
				var z = listOfTraits.split(',');
				//var currentTrait = z.map(i => parseInt(i) ? parseInt(i) : i);
				if(dataObject[key] == listOfTraits[i]){
					listOfPeople.push(key);
				}
			}
		}
	}else {
		getTrait(traitType,userInput, list);
	}
}
function displayListOfPeople(listOfPeople, label) {
    for (var i = 0; i < listOfPeople.length; i++) {
        displayPerson(dataObject[listOfPeople[i]], label);
    }
}

function displayPerson(person, label) {
    var buildPerson = "" + label;
    for (var key in person) {
    	if(key == "weight"){
    		buildPerson = buildPerson + key + ": " + JSON.stringify(person[key]) + " lbs\r\n";
    	}else if(key == "parents"){
    		for (var i = 0; i < person[key].length; i++){
  					buildPerson = buildPerson + key + " " + (i + 1) + ": " + dataObject[person[key][i]].firstName + " " + dataObject[person[key][i]].lastName + "\r\n";
  				}
    	}else if(key == "currentSpouse" && person[key] != null){
    		buildPerson = buildPerson + "Spouse: " + dataObject[person[key]].firstName + " " + dataObject[person[key]].lastName + "\r\n";
    	}else if (key == "currentSpouse" && person[key] == null){
    		buildPerson = buildPerson + "Spouse: " + "Single and ready to MINGLE!\r\n";
    	}else if(key == "dob"){
    		buildPerson = buildPerson + key + ": " + JSON.stringify(person[key]) + "\r\n";
    		buildPerson = buildPerson + "Age: " + getAge(person[key]) + "\r\n";
    	}else if(key == "height"){
    		buildPerson = buildPerson + key + ": " + Math.round(person[key] / 12) + "'" + (person[key] % 12) + "\"\r\n";
    	}else
        buildPerson = buildPerson + key + ": " + JSON.stringify(person[key]) + "\r\n";
    }
    
    alert(buildPerson);
    console.log(buildPerson);
}

function immediateFamily(result, list) {
    getDescendant(result, list);
    getParents(dataObject[result].parents, list);
    getSiblings(dataObject[result].parents, list);
    getSpouse(result, list);
}

function getParents(person, list) {
    for (var i = 0; i < person.length; i++) {
        list.push(person[i]);
    }
}

function getDescendant(person, list) {
    var kids = [];
    for (var item in dataObject) {
        if (dataObject[item].parents.length != 0) {
            if (dataObject[item].parents[0] == person || dataObject[item].parents[1] == person) {
                list.push(item);
                kids.push(item);
            }
        }
    }
    return kids;
}

function getGrandKids(person, list) {
    for (var i = 0; i < person.length; i++) {
        getDescendant(person[i], list);
    }
}

function getSiblings(person, personToList) {
    var siblings = [];
    for (var key in dataObject) {
        if (person.length != 0 && person.length != undefined) {
            if (person[0] == dataObject[key].parents[0] || person[1] == dataObject[key].parents[1] ||
                person[0] == dataObject[key].parents[1] || person[1] == dataObject[key].parents[0]) {
                personToList.push(key);
                siblings.push(key);
            }
        }
    }
    return siblings;
}

function checkDuplicates(list) {
    var temp = [];
    for (var i = 0; i < list.length; i++) {
        if (temp.indexOf(list[i]) == -1) {
            temp.push(list[i]);
        }
    }
    return temp;
}

function error(checkError) {
    try {
        if (checkError == undefined)
            throw ('Error');
    } catch (error) {
        console.log(error.message);
        console.log("Error - There is no data");
        alert("Error - No person fits that criteria")
    }
    return checkError;
}